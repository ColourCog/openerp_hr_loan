<openerp>
  <data>

    <record id="view_hr_loan_tree" model="ir.ui.view">
      <field name="name">hr.loan.tree</field> 
      <field name="model">hr.loan</field> 
      <field name="type">tree</field> 
      <field name="arch" type="xml"> 
        <tree string="Employee Loans" colors="gray:state=='cancelled';green:state=='accepted';blue:state=='confirm'"> 
          <field name="employee_id"/> 
          <field name="date"/> 
          <field name="amount" /> 
          <field name="balance" />
          <field name="state"/> 
        </tree> 
      </field> 
    </record>
    
    <record id="view_hr_loan_form" model="ir.ui.view"> 
      <field name="name">hr.loan.form</field> 
      <field name="model">hr.loan</field> 
      <field name="type">form</field> 
      <field name="arch" type="xml"> 
        <form string="Employee Loans" version="7.0"> 
          <header>
            <button name="confirm" states="draft" string="Submit to Manager" type="workflow" class="oe_highlight"/>
            <button name="validate" states="confirm" string="Approve" type="workflow" groups="base.group_hr_user" class="oe_highlight"/>
            <button name="refuse" states="confirm,accepted" string="Refuse" type="workflow" groups="base.group_hr_user" />
            <button name="draft" states="confirm,cancelled" string="Set to Draft" type="workflow" groups="base.group_hr_user" />
            <button name="done" states="accepted" string="Generate Accounting Entries" type="workflow" groups="account.group_account_invoice" class="oe_highlight"/>
            <button name="action_view_receipt" states="done" string="Open Accounting Entries" type="object" groups="account.group_account_invoice"/>
            <field name="state" widget="statusbar" statusbar_visible="draft,confirm,accepted,done,paid" statusbar_colors='{"confirm":"blue","cancelled":"red"}'/>
          </header>
          <sheet> 
            <h1> <label string="Loan"/> <field name="name" class="oe_inline" readonly="1"/> </h1> 
            <group>
              <group>
                <field name="employee_id" on_change="onchange_employee_id(employee_id)"/>
                <field name="date"/>
                <field name="company_id" groups="base.group_multi_company"/>
                <field name="user_valid" attrs="{'invisible': [('state','=','draft')]}"/>
              </group>
              <group>
                <field name="amount"/>
                <field name="nb_payments"/>
                <field name="installment" readonly="1"/>
              </group>
            </group>
            <group>
                <field name="balance" readonly="1"/>
            </group>
            <notebook>
                <page string="Description">
                  <field name="notes" />
                </page>
                <page string="Accounting" attrs="{'invisible': [('state','=','draft'),('state','=','confirm')]}">
                  <group>
                    <field name="account_debit" />
                    <field name="account_credit" />
                    <field name="journal_id" />
                  </group>
                </page>
            </notebook>
            
          </sheet> 
          <div class="oe_chatter"> 
            <field name="message_follower_ids" widget="mail_followers"/> 
            <field name="message_ids" widget="mail_thread" placeholder="Share a message..."/> 
          </div> 
        </form> 
      </field> 
    </record> 
    
    <record id="view_hr_loan_filter" model="ir.ui.view"> 
      <field name="name">hr.loan.filter</field> 
      <field name="model">hr.loan</field> 
      <field name="type">search</field> 
      <field name="arch" type="xml"> 
        <search string="Search Loans"> 
          <filter 
            icon="terp-gtk-media-pause" 
            string="Draft" 
            domain="[('state','=','draft')]"/> 
          <filter 
            icon="terp-gtk-jump-to-ltr" 
            string="Pending approval" 
            domain="[('state','=','confirm')]"/> 
          <filter 
            icon="terp-check" 
            string="Accepted" 
            domain="[('state','=','accepted')]"/> 
          <filter 
            icon="terp-check" 
            string="Pending" 
            domain="[('state','=','done')]"/> 
          <filter 
            icon="terp-check" 
            string="Paid" 
            domain="[('state','=','paid')]"/> 
          <group expand="0" string="Group By..." > 
            <filter 
              string="Employee" 
              icon="terp-personal" 
              domain="[]" 
              context="{'group_by':'employee_id'}"/> 
            <separator orientation="vertical"/> 
            <filter 
              string="State" 
              icon="terp-stock_effects-object-colorize" 
              domain="[]" 
              context="{'group_by':'state'}"/> 
            <filter 
              string="Validation Date" 
              icon="terp-go-month" 
              domain="[]" 
              context="{'group_by':'date_valid'}"/> 
          </group> 
        </search> 
      </field> 
    </record> 
    <record model="ir.ui.view" id="view_hr_loan_graph"> 
      <field name="name">hr.loan.graph</field> 
      <field name="model">hr.loan</field> 
      <field name="arch" type="xml"> 
        <graph string="Expense" type="bar"> 
          <field name="employee_id"/> 
          <field name="amount" operator="+"/> 
        </graph> 
      </field> 
    </record> 
    
    <record id="action_hr_loan_form" model="ir.actions.act_window"> 
      <field name="name">Employees Loans</field> 
      <field name="type">ir.actions.act_window</field> 
      <field name="res_model">hr.loan</field> 
      <field name="view_type">form</field> 
      <field name="view_mode">tree,form,graph</field> 
      <field name="search_view_id" ref="view_hr_loan_filter"/> 
      <field name="help">Employee Loans</field> 
    </record> 
    
    <!--<menuitem action="action_hr_loan_form" id="menu_hr_loan" parent="menu_hr_config_employeess" sequence="40" />--> 
    <menuitem action="action_hr_loan_form" id="hr_menu_hr_loan" parent="hr.menu_hr_main" sequence="90" /> 
  

  </data>
</openerp>
